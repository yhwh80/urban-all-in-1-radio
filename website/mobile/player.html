<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no"
        name="viewport" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Urban Radio - Live</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#00f5ff",
                        "accent": "#ff00ff",
                        "background-dark": "#0a0a0f",
                        "surface-dark": "#12121a",
                    },
                    fontFamily: {
                        "display": ["Spline Sans", "sans-serif"]
                    },
                },
            },
        }
    </script>
    <style>
        body {
            min-height: 100dvh;
            touch-action: manipulation;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes pulse-bar {

            0%,
            100% {
                height: 30%;
            }

            50% {
                height: 100%;
            }
        }

        .visualizer-bar {
            animation: pulse-bar 0.8s ease-in-out infinite;
        }

        .visualizer-bar:nth-child(2) {
            animation-delay: 0.1s;
        }

        .visualizer-bar:nth-child(3) {
            animation-delay: 0.2s;
        }

        .visualizer-bar:nth-child(4) {
            animation-delay: 0.3s;
        }

        .visualizer-bar:nth-child(5) {
            animation-delay: 0.15s;
        }
    </style>
</head>

<body class="font-display bg-background-dark text-white antialiased overflow-hidden">
    <div class="relative flex h-screen w-full flex-col overflow-hidden">
        <!-- Background Gradient -->
        <div class="absolute inset-0 z-0">
            <div class="absolute top-[-20%] left-[-20%] w-[60%] h-[40%] bg-primary/20 rounded-full blur-[100px]"></div>
            <div class="absolute bottom-[-20%] right-[-20%] w-[70%] h-[50%] bg-blue-600/10 rounded-full blur-[100px]">
            </div>
        </div>

        <!-- Header -->
        <header class="flex items-center justify-between p-4 pt-12 z-10 relative">
            <a href="../index.html"
                class="flex items-center justify-center text-white/70 hover:text-white size-10 rounded-full active:bg-white/10">
                <span class="material-symbols-outlined text-2xl">keyboard_arrow_left</span>
            </a>
            <div class="flex flex-col items-center">
                <div class="flex items-center gap-2">
                    <span id="liveIndicator" class="w-2 h-2 rounded-full bg-primary animate-pulse"></span>
                    <span class="text-xs font-bold tracking-widest uppercase text-primary">Live Broadcast</span>
                </div>
                <h2 class="text-base font-bold leading-tight mt-0.5">Urban Radio</h2>
            </div>
            <button
                class="flex items-center justify-center text-white/70 hover:text-white size-10 rounded-full active:bg-white/10">
                <span class="material-symbols-outlined">more_horiz</span>
            </button>
        </header>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col justify-center items-center px-6 z-10 relative">
            <!-- Visualizer -->
            <div id="visualizer" class="flex items-center justify-center gap-1 h-24 mb-8 opacity-50">
                <div class="w-1 bg-primary rounded-full visualizer-bar" style="height: 40%;"></div>
                <div class="w-1 bg-primary rounded-full visualizer-bar" style="height: 70%;"></div>
                <div class="w-1 bg-primary rounded-full visualizer-bar" style="height: 100%;"></div>
                <div class="w-1 bg-primary rounded-full visualizer-bar" style="height: 60%;"></div>
                <div class="w-1 bg-primary rounded-full visualizer-bar" style="height: 30%;"></div>
            </div>

            <!-- Genre Badge -->
            <div class="mb-4">
                <span id="genreBadge"
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold tracking-wider uppercase bg-primary/20 text-primary border border-primary/30">
                    LOADING...
                </span>
            </div>

            <!-- Track Info -->
            <div class="text-center mb-4 w-full px-4">
                <h1 id="trackTitle" class="text-2xl font-bold leading-tight truncate">CONNECTING...</h1>
                <p id="trackArtist" class="text-primary text-lg font-medium truncate mt-1">WAITING FOR DATA</p>
            </div>

            <!-- Progress Bar -->
            <div class="w-full max-w-xs px-4 mb-8">
                <div class="flex justify-between text-xs text-white/50 mb-1">
                    <span id="elapsedTime">0:00</span>
                    <span id="remainingTime">-0:00</span>
                </div>
                <div class="w-full h-1 bg-white/10 rounded-full overflow-hidden">
                    <div id="progressBar"
                        class="h-full bg-gradient-to-r from-primary to-accent rounded-full transition-all duration-1000"
                        style="width: 0%;"></div>
                </div>
            </div>

            <!-- Play Button -->
            <div class="relative mb-12">
                <div class="absolute -inset-2 bg-primary rounded-full blur opacity-30"></div>
                <button id="playBtn"
                    class="relative flex items-center justify-center size-24 rounded-full bg-primary text-white shadow-2xl shadow-primary/40 active:scale-95 transition-transform">
                    <span id="playIcon" class="material-symbols-outlined text-5xl"
                        style="font-variation-settings: 'FILL' 1;">play_arrow</span>
                </button>
            </div>

            <!-- Volume Control -->
            <div class="flex items-center gap-4 w-full max-w-xs px-4">
                <span class="material-symbols-outlined text-white/50 text-xl">volume_down</span>
                <input id="volumeSlider" type="range" min="0" max="100" value="70"
                    class="flex-1 h-1 bg-white/20 rounded-full appearance-none cursor-pointer
                    [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 
                    [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:shadow-lg">
                <span class="material-symbols-outlined text-white text-xl">volume_up</span>
            </div>
        </main>

        <!-- Bottom Nav -->
        <nav
            class="flex justify-around items-center p-4 pb-8 z-10 border-t border-white/5 bg-background-dark/80 backdrop-blur-lg">
            <button class="flex flex-col items-center gap-1 text-primary">
                <span class="material-symbols-outlined text-2xl" style="font-variation-settings: 'FILL' 1;">radio</span>
                <span class="text-[10px] font-medium">Live</span>
            </button>
            <button onclick="window.location.href='schedule.html'"
                class="flex flex-col items-center gap-1 text-white/50 hover:text-white active:text-primary">
                <span class="material-symbols-outlined text-2xl">calendar_month</span>
                <span class="text-[10px] font-medium">Schedule</span>
            </button>
            <button onclick="window.location.href='news.html'"
                class="flex flex-col items-center gap-1 text-white/50 hover:text-white active:text-primary">
                <span class="material-symbols-outlined text-2xl">newspaper</span>
                <span class="text-[10px] font-medium">News</span>
            </button>
            <button onclick="window.location.href='discover.html'"
                class="flex flex-col items-center gap-1 text-white/50 hover:text-white active:text-primary">
                <span class="material-symbols-outlined text-2xl">explore</span>
                <span class="text-[10px] font-medium">Discover</span>
            </button>
        </nav>
    </div>

    <!-- Audio Element -->
    <audio id="radioStream" preload="none"></audio>

    <script>
        // Configuration
        const CONFIG = {
            streamUrl: 'https://a7.asurahosting.com:6660/radio.mp3',
            nowPlayingUrl: 'https://a7.asurahosting.com/api/nowplaying/urban_-_all_in_1_radio',
            updateInterval: 5000
        };

        // Elements
        const radioStream = document.getElementById('radioStream');
        const playBtn = document.getElementById('playBtn');
        const playIcon = document.getElementById('playIcon');
        const trackTitle = document.getElementById('trackTitle');
        const trackArtist = document.getElementById('trackArtist');
        const volumeSlider = document.getElementById('volumeSlider');
        const visualizer = document.getElementById('visualizer');
        const liveIndicator = document.getElementById('liveIndicator');
        const genreBadge = document.getElementById('genreBadge');
        const progressBar = document.getElementById('progressBar');
        const elapsedTime = document.getElementById('elapsedTime');
        const remainingTime = document.getElementById('remainingTime');

        let isPlaying = false;
        let currentTrackData = null;

        // Initialize
        radioStream.src = CONFIG.streamUrl;
        radioStream.volume = 0.7;

        // Format seconds to M:SS
        function formatTime(seconds) {
            if (!seconds || seconds < 0) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Update progress bar
        function updateProgress() {
            if (!currentTrackData) return;
            const { played_at, duration } = currentTrackData;
            const now = Math.floor(Date.now() / 1000);
            const elapsed = now - played_at;
            const remaining = Math.max(0, duration - elapsed);
            const percent = Math.min(100, (elapsed / duration) * 100);

            progressBar.style.width = `${percent}%`;
            elapsedTime.textContent = formatTime(elapsed);
            remainingTime.textContent = `-${formatTime(remaining)}`;
        }

        // Play/Pause
        function togglePlay() {
            if (isPlaying) {
                radioStream.pause();
                playIcon.textContent = 'play_arrow';
                visualizer.style.opacity = '0.3';
                liveIndicator.classList.remove('animate-pulse');
                liveIndicator.classList.add('bg-gray-500');
                liveIndicator.classList.remove('bg-primary');
            } else {
                radioStream.play().catch(e => console.error(e));
                playIcon.textContent = 'pause';
                visualizer.style.opacity = '1';
                liveIndicator.classList.add('animate-pulse');
                liveIndicator.classList.remove('bg-gray-500');
                liveIndicator.classList.add('bg-primary');
            }
            isPlaying = !isPlaying;
        }

        playBtn.addEventListener('click', togglePlay);

        // Volume
        volumeSlider.addEventListener('input', (e) => {
            radioStream.volume = e.target.value / 100;
        });

        // Now Playing
        async function fetchNowPlaying() {
            try {
                const response = await fetch(CONFIG.nowPlayingUrl);
                const data = await response.json();
                if (data && data.now_playing && data.now_playing.song) {
                    const np = data.now_playing;
                    trackTitle.textContent = np.song.title || 'Unknown Track';
                    trackArtist.textContent = np.song.artist || 'Unknown Artist';

                    // Genre/Playlist badge
                    const genre = np.playlist || np.song.genre || 'LIVE';
                    genreBadge.textContent = genre.toUpperCase();

                    // Store for progress updates
                    currentTrackData = {
                        played_at: np.played_at,
                        duration: np.duration
                    };
                    updateProgress();
                }
            } catch (e) {
                console.error('Error fetching now playing:', e);
                genreBadge.textContent = 'OFFLINE';
            }
        }

        fetchNowPlaying();
        setInterval(fetchNowPlaying, CONFIG.updateInterval);
        // Update progress every second for smooth bar
        setInterval(updateProgress, 1000);
    </script>
</body>

</html>